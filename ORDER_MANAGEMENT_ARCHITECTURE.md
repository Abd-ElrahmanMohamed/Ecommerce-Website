# Order Management System - Architecture Overview

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ANGULAR FRONTEND (Port 3000)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              APP ROUTES (/app.routes.ts)             â”‚   â”‚
â”‚  â”‚  /orders â†’ OrdersComponent (Protected)               â”‚   â”‚
â”‚  â”‚  /admin/orders â†’ AdminOrdersComponent (Admin)        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                    â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  ORDER SERVICE  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â”‚          (order.service.ts)           â”‚            â”‚
â”‚         â”‚          getUserOrders()              â”‚            â”‚
â”‚         â”‚          getAllOrders()               â”‚            â”‚
â”‚         â”‚          cancelOrder()                â”‚            â”‚
â”‚         â”‚          updateOrderStatusApi()       â”‚            â”‚
â”‚         â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚            â”‚
â”‚         â”‚                                       â”‚            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚            â”‚                         â”‚            â”‚     â”‚
â”‚ â”Œâ”€â”€â–¼â”€â”€â”€â”    â”Œâ”€â”€â–¼â”€â”€â”€â”                 â”Œâ”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â–¼â”€â”€â”  â”‚
â”‚ â”‚ORDERSâ”‚    â”‚ADMIN â”‚                 â”‚NOTIF. â”‚   â”‚HTTP â”‚  â”‚
â”‚ â”‚COMP. â”‚    â”‚ORDERSâ”‚                 â”‚SERVICEâ”‚   â”‚CLIENT   â”‚
â”‚ â”‚      â”‚    â”‚COMP. â”‚                 â”‚       â”‚   â”‚     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ HTTP Requests
                           â”‚ (Bearer Token)
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      EXPRESS BACKEND (Port 5000 / api/orders)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚       ORDER ROUTES (.routes.js)        â”‚     â”‚
â”‚  â”‚  GET    /                (protected)   â”‚     â”‚
â”‚  â”‚  GET    /admin/all       (admin)      â”‚     â”‚
â”‚  â”‚  POST   /                (protected)   â”‚     â”‚
â”‚  â”‚  GET    /:id             (protected)   â”‚     â”‚
â”‚  â”‚  PUT    /:id/cancel      (protected)   â”‚     â”‚
â”‚  â”‚  PUT    /:id/status      (admin)      â”‚     â”‚
â”‚  â”‚  PUT    /:id/request-return(protected) â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                   â”‚                              â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚         â”‚ ORDER CONTROLLER   â”‚                  â”‚
â”‚         â”‚ (.js)              â”‚                  â”‚
â”‚         â”‚                    â”‚                  â”‚
â”‚         â”‚ âœ… createOrder()   â”‚                  â”‚
â”‚         â”‚ âœ… getUserOrders() â”‚                  â”‚
â”‚         â”‚ âœ… getOrderById()  â”‚                  â”‚
â”‚         â”‚ âœ… cancelOrder()   â”‚                  â”‚
â”‚         â”‚    â”œâ”€ Check canCancel                 â”‚
â”‚         â”‚    â”œâ”€ Restore Stock â—„â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚         â”‚    â”œâ”€ Update Status          â”‚       â”‚
â”‚         â”‚    â””â”€ Disable Future Cancel  â”‚       â”‚
â”‚         â”‚ âœ… requestReturn()           â”‚       â”‚
â”‚         â”‚ âœ… getAllOrders()            â”‚       â”‚
â”‚         â”‚ âœ… updateOrderStatus()       â”‚       â”‚
â”‚         â”‚                              â”‚       â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                   â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚                â”‚               â”‚           â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         â”‚ORDER MODEL  â”‚  â”‚PRODUCT    â”‚    â”‚
â”‚  â”‚         â”‚(Mongoose)   â”‚  â”‚MODEL      â”‚    â”‚
â”‚  â”‚         â”‚             â”‚  â”‚(Mongoose) â”‚    â”‚
â”‚  â”‚         â”‚â€¢ _id        â”‚  â”‚â€¢ _id      â”‚    â”‚
â”‚  â”‚         â”‚â€¢ orderNum   â”‚  â”‚â€¢ name     â”‚    â”‚
â”‚  â”‚         â”‚â€¢ user ID    â”‚  â”‚â€¢ stock    â”‚    â”‚
â”‚  â”‚         â”‚â€¢ items[]    â”‚  â”‚â€¢ price    â”‚    â”‚
â”‚  â”‚         â”‚â€¢ status     â”‚  â”‚â€¢ qty      â”‚    â”‚
â”‚  â”‚         â”‚â€¢ totalAmt   â”‚  â”‚â€¢ image    â”‚    â”‚
â”‚  â”‚         â”‚â€¢ canCancel  â”‚  â”‚â€¢ cat ID   â”‚    â”‚
â”‚  â”‚         â”‚â€¢ payment    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”‚         â”‚â€¢ address    â”‚                   â”‚
â”‚  â”‚         â”‚â€¢ timestamps â”‚                   â”‚
â”‚  â”‚         â”‚             â”‚                   â”‚
â”‚  â”‚         â”‚ PRE-SAVE    â”‚                   â”‚
â”‚  â”‚         â”‚ HOOKS:      â”‚                   â”‚
â”‚  â”‚         â”‚ â€¢ Gen Order â”‚                   â”‚
â”‚  â”‚         â”‚   Num       â”‚                   â”‚
â”‚  â”‚         â”‚ â€¢ Update    â”‚                   â”‚
â”‚  â”‚         â”‚   canCancel â”‚                   â”‚
â”‚  â”‚         â”‚â€¢ Set return â”‚                   â”‚
â”‚  â”‚         â”‚  deadline   â”‚                   â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ MongoDB Connection
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚
    â”‚    MONGODB         â”‚
    â”‚                    â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚ â”‚  Orders      â”‚  â”‚
    â”‚ â”‚  Collection  â”‚  â”‚
    â”‚ â”‚   ~45 docs   â”‚  â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚ â”‚  Products    â”‚  â”‚
    â”‚ â”‚  Collection  â”‚  â”‚
    â”‚ â”‚  ~150 docs   â”‚  â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚ â”‚  Users       â”‚  â”‚
    â”‚ â”‚  Collection  â”‚  â”‚
    â”‚ â”‚  ~50 docs    â”‚  â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: User Order Cancellation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. USER VIEWS ORDERS                                     â”‚
â”‚    URL: /orders                                          â”‚
â”‚    â†“                                                      â”‚
â”‚    OrdersComponent loads                                 â”‚
â”‚    Calls: orderService.getUserOrders()                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. SERVICE MAKES REQUEST                                â”‚
â”‚    GET http://localhost:5000/api/orders                 â”‚
â”‚    Headers: Authorization: Bearer {token}               â”‚
â”‚    â†“                                                      â”‚
â”‚    Response: Array of user's orders                      â”‚
â”‚    [{_id, orderNumber, status, totalAmount, ...}]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. UI RENDERS ORDERS                                    â”‚
â”‚    Shows order list with expandable cards               â”‚
â”‚    Each order displays:                                  â”‚
â”‚    - Order number                                        â”‚
â”‚    - Status badge (â³ Pending)                           â”‚
â”‚    - Total amount (EGP 599.99)                           â”‚
â”‚    - Item count (3 items)                                â”‚
â”‚    - Expand button (â–¼)                                   â”‚
â”‚    - [Cancel Order] button (if canCancel && Pending)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. USER CLICKS CANCEL                                   â”‚
â”‚    â†“                                                      â”‚
â”‚    Confirmation Dialog:                                  â”‚
â”‚    "Are you sure you want to cancel                      â”‚
â”‚     order ORD-xxx-1?"                                    â”‚
â”‚    â†“                                                      â”‚
â”‚    User clicks YES                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. SERVICE SENDS CANCEL REQUEST                         â”‚
â”‚    PUT http://localhost:5000/api/orders/{orderId}/cancelâ”‚
â”‚    Headers: Authorization: Bearer {token}               â”‚
â”‚    Body: {}                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. BACKEND PROCESSES CANCELLATION                       â”‚
â”‚                                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ Check: canCancel flag = true?          â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â†“                                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ For each item in order:                â”‚          â”‚
â”‚    â”‚  - Find Product by item.product ID     â”‚          â”‚
â”‚    â”‚  - Add item.quantity back to stock     â”‚          â”‚
â”‚    â”‚  - Save product                        â”‚          â”‚
â”‚    â”‚                                        â”‚          â”‚
â”‚    â”‚ Example:                               â”‚          â”‚
â”‚    â”‚  Item: Product A, Qty 2                â”‚          â”‚
â”‚    â”‚  Before: stock = 8                     â”‚          â”‚
â”‚    â”‚  After:  stock = 8 + 2 = 10            â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â†“                                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ Update Order:                          â”‚          â”‚
â”‚    â”‚  - status = "Cancelled"                â”‚          â”‚
â”‚    â”‚  - canCancel = false                   â”‚          â”‚
â”‚    â”‚  - updatedAt = now()                   â”‚          â”‚
â”‚    â”‚  - Save to DB                          â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â†“                                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ Return Response:                       â”‚          â”‚
â”‚    â”‚ {                                      â”‚          â”‚
â”‚    â”‚   success: true,                       â”‚          â”‚
â”‚    â”‚   order: {...updated order...}         â”‚          â”‚
â”‚    â”‚ }                                      â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. FRONTEND UPDATES UI                                  â”‚
â”‚    â†“                                                      â”‚
â”‚    Success Notification:                                 â”‚
â”‚    "âœ… Order cancelled successfully"                     â”‚
â”‚    â†“                                                      â”‚
â”‚    Update order display:                                 â”‚
â”‚    - Status changes: â³ Pending â†’ âŒ Cancelled           â”‚
â”‚    - Cancel button disappears                            â”‚
â”‚    - Order card updates                                  â”‚
â”‚    â†“                                                      â”‚
â”‚    Reload orders list                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. END STATE                                            â”‚
â”‚    Order status: CANCELLED                               â”‚
â”‚    Stock: RESTORED                                       â”‚
â”‚    canCancel: FALSE (can't cancel again)                â”‚
â”‚    User notified                                         â”‚
â”‚    Refund process can begin (future feature)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: Admin Order Status Update

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ADMIN VIEWS ORDERS                                   â”‚
â”‚    URL: /admin/orders                                    â”‚
â”‚    â†“                                                      â”‚
â”‚    AdminOrdersComponent loads                            â”‚
â”‚    Calls: orderService.getAllOrders()                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. SERVICE MAKES REQUEST                                â”‚
â”‚    GET http://localhost:5000/api/orders/admin/all       â”‚
â”‚    Headers:                                              â”‚
â”‚      Authorization: Bearer {admin-token}                â”‚
â”‚      x-admin-check: true                                 â”‚
â”‚    â†“                                                      â”‚
â”‚    Response: Array of ALL orders                         â”‚
â”‚    [{_id, orderNumber, status, user, items, ...}]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. UI RENDERS ADMIN DASHBOARD                           â”‚
â”‚    Shows:                                                â”‚
â”‚    - Stats Cards (Total: 45, Pending: 5, etc.)          â”‚
â”‚    - Filter dropdown                                     â”‚
â”‚    - Orders table with columns:                          â”‚
â”‚      * Order Number                                      â”‚
â”‚      * Customer Name                                     â”‚
â”‚      * Total Amount                                      â”‚
â”‚      * Current Status                                    â”‚
â”‚      * Created Date                                      â”‚
â”‚      * [Edit] button                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ADMIN CLICKS EDIT                                    â”‚
â”‚    â†“                                                      â”‚
â”‚    Row becomes editable:                                 â”‚
â”‚    - [Status Dropdown â–¼]                                 â”‚
â”‚    - [Save] button                                       â”‚
â”‚    - [Cancel] button                                     â”‚
â”‚    â†“                                                      â”‚
â”‚    Admin selects new status:                             â”‚
â”‚    [Pending â–¼] â†’ Selects [Processing]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ADMIN CLICKS SAVE                                    â”‚
â”‚    â†“                                                      â”‚
â”‚    Service sends:                                        â”‚
â”‚    PUT http://localhost:5000/api/orders/{id}/status    â”‚
â”‚    Headers: Authorization: Bearer {admin-token}         â”‚
â”‚    Body: { status: "Processing" }                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. BACKEND UPDATES STATUS                               â”‚
â”‚                                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ Middleware: authorize('admin')         â”‚          â”‚
â”‚    â”‚ Check: User role = 'admin'?            â”‚          â”‚
â”‚    â”‚ Continue: YES âœ“                        â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â†“                                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ Validate status:                       â”‚          â”‚
â”‚    â”‚ Is "Processing" in valid statuses?     â”‚          â”‚
â”‚    â”‚ YES: ["Pending", "Processing", ...]   â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â†“                                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ Update Order:                          â”‚          â”‚
â”‚    â”‚  Order.findByIdAndUpdate(id, {         â”‚          â”‚
â”‚    â”‚    status: "Processing",               â”‚          â”‚
â”‚    â”‚    updatedAt: now()                    â”‚          â”‚
â”‚    â”‚  })                                    â”‚          â”‚
â”‚    â”‚ Pre-save hook auto-updates canCancel   â”‚          â”‚
â”‚    â”‚  (still true for Processing)           â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â†“                                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ Return Response:                       â”‚          â”‚
â”‚    â”‚ {                                      â”‚          â”‚
â”‚    â”‚   success: true,                       â”‚          â”‚
â”‚    â”‚   message: "Order status updated",     â”‚          â”‚
â”‚    â”‚   order: {...updated order...}         â”‚          â”‚
â”‚    â”‚ }                                      â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. FRONTEND UPDATES UI                                  â”‚
â”‚    â†“                                                      â”‚
â”‚    Success Notification:                                 â”‚
â”‚    "âœ… Order status updated"                             â”‚
â”‚    â†“                                                      â”‚
â”‚    Exit edit mode                                        â”‚
â”‚    â†“                                                      â”‚
â”‚    Reload all orders                                     â”‚
â”‚    â†“                                                      â”‚
â”‚    Table updates:                                        â”‚
â”‚    - Order row shows: ğŸ”„ Processing                      â”‚
â”‚    - Stats update: Pending: 4, Processing: 6            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. END STATE                                            â”‚
â”‚    Order status: PROCESSING                              â”‚
â”‚    canCancel: TRUE (can still cancel)                   â”‚
â”‚    Dashboard updated                                     â”‚
â”‚    Stats accurate                                        â”‚
â”‚    Admin notified of success                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Status Transition Matrix

```
FROM / TO      Pending  Processing  Ready  Shipped  Received  Cancelled  Refused
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Pending        âœ—        âœ“           âœ—      âœ—        âœ—         âœ“ (user)   âœ“(admin)
Processing     âœ—        âœ—           âœ“      âœ—        âœ—         âœ“ (user)   âœ“(admin)
Ready          âœ—        âœ—           âœ—      âœ“        âœ—         âœ—          âœ“(admin)
Shipped        âœ—        âœ—           âœ—      âœ—        âœ“         âœ—          âœ—
Received       âœ—        âœ—           âœ—      âœ—        âœ—         âœ—          âœ—
Cancelled      âœ—        âœ—           âœ—      âœ—        âœ—         âœ—          âœ—
Refused        âœ—        âœ—           âœ—      âœ—        âœ—         âœ—          âœ—

Legend:
âœ“ = Allowed transition
âœ— = Forbidden transition
âœ“ (user) = User can cancel
âœ“ (admin) = Admin can force
```

---

## Component Hierarchy

```
AppComponent
    â”‚
    â”œâ”€ LayoutComponent
    â”‚    â”œâ”€ HeaderComponent
    â”‚    â”œâ”€ NavComponent
    â”‚    â””â”€ FooterComponent
    â”‚
    â””â”€ Routes
         â”œâ”€ HomeComponent
         â”œâ”€ ProductsComponent
         â”œâ”€ OrdersComponent â—„â”€â”€â”€ NEW (User)
         â”‚    â”‚
         â”‚    â”œâ”€ Order Card (repeater)
         â”‚    â”‚    â”œâ”€ Status Badge
         â”‚    â”‚    â”œâ”€ Timeline
         â”‚    â”‚    â””â”€ Details Section
         â”‚    â”‚         â”œâ”€ Items Table
         â”‚    â”‚         â”œâ”€ Address Info
         â”‚    â”‚         â””â”€ Cancel Button
         â”‚    â”‚
         â”‚    â”œâ”€ Empty State
         â”‚    â””â”€ Loading State
         â”‚
         â”œâ”€ AdminDashboard
         â”‚    â”œâ”€ AdminOrdersComponent â—„â”€â”€â”€ ENHANCED (Admin)
         â”‚    â”‚    â”‚
         â”‚    â”‚    â”œâ”€ Stats Grid
         â”‚    â”‚    â”‚    â””â”€ Stat Card (repeater)
         â”‚    â”‚    â”‚
         â”‚    â”‚    â”œâ”€ Filters Section
         â”‚    â”‚    â”‚
         â”‚    â”‚    â”œâ”€ Orders Table
         â”‚    â”‚    â”‚    â”œâ”€ Header Row
         â”‚    â”‚    â”‚    â”œâ”€ Order Row (repeater)
         â”‚    â”‚    â”‚    â”‚    â”œâ”€ Status Badge
         â”‚    â”‚    â”‚    â”‚    â”œâ”€ Edit Dropdown
         â”‚    â”‚    â”‚    â”‚    â””â”€ Details Expansion
         â”‚    â”‚    â”‚    â””â”€ Pagination (future)
         â”‚    â”‚    â”‚
         â”‚    â”‚    â”œâ”€ Empty State
         â”‚    â”‚    â””â”€ Loading State
         â”‚    â”‚
         â”‚    â”œâ”€ AdminProductsComponent
         â”‚    â”œâ”€ AdminCategoriesComponent
         â”‚    â””â”€ ...other admin panels
         â”‚
         â””â”€ ...other components
```

---

## Service Dependencies

```
OrdersComponent
        â”‚
        â”œâ”€â”€â–º OrderService
        â”‚        â”‚
        â”‚        â”œâ”€â”€â–º HttpClient
        â”‚        â”‚        â”‚
        â”‚        â”‚        â””â”€â”€â–º Backend API
        â”‚        â”‚
        â”‚        â”œâ”€â”€â–º NotificationService
        â”‚        â”‚        â”‚
        â”‚        â”‚        â””â”€â”€â–º UI Toast/Alert
        â”‚        â”‚
        â”‚        â””â”€â”€â–º AuthService (for token)
        â”‚
        â””â”€â”€â–º Router
                 â”‚
                 â””â”€â”€â–º Navigation
```

---

## Security Layers

```
Request Path:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT                            â”‚
â”‚  (Send JWT Token in Authorization header)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ HTTPS
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MIDDLEWARE                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. protect middleware (auth.js):                  â”‚ â”‚
â”‚  â”‚    - Verify JWT token                            â”‚ â”‚
â”‚  â”‚    - Extract userId                              â”‚ â”‚
â”‚  â”‚    - Attach to req.user                          â”‚ â”‚
â”‚  â”‚    - Continue or 401 Unauthorized                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 2. authorize middleware (auth.js):               â”‚ â”‚
â”‚  â”‚    - Check req.user.role === 'admin'            â”‚ â”‚
â”‚  â”‚    - Continue or 403 Forbidden                   â”‚ â”‚
â”‚  â”‚    - Only for admin routes                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONTROLLER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 3. Data Validation:                              â”‚ â”‚
â”‚  â”‚    - Validate status enum                        â”‚ â”‚
â”‚  â”‚    - Validate user ownership                     â”‚ â”‚
â”‚  â”‚    - Validate canCancel flag                     â”‚ â”‚
â”‚  â”‚    - Input sanitization                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DATABASE                             â”‚
â”‚  (Only verified operations proceed to DB)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Flow

```
User Action (e.g., Cancel Order)
    â”‚
    â”œâ”€ Frontend Validation
    â”‚    â”œâ”€ Check if order.canCancel = true
    â”‚    â”œâ”€ Check if status in ['Pending', 'Processing']
    â”‚    â””â”€ If fails: Show error, return
    â”‚
    â”œâ”€ API Call
    â”‚    â”œâ”€ Include JWT token
    â”‚    â””â”€ If network error: Show "Connection failed"
    â”‚
    â”œâ”€ Backend Middleware (protect)
    â”‚    â”œâ”€ Verify token
    â”‚    â””â”€ If fails: 401 Unauthorized
    â”‚
    â”œâ”€ Backend Controller
    â”‚    â”œâ”€ Verify canCancel flag again
    â”‚    â”‚    â””â”€ If false: 400 "Cannot cancel"
    â”‚    â”œâ”€ Process cancellation
    â”‚    â”‚    â”œâ”€ Restore stock
    â”‚    â”‚    â”œâ”€ Update status
    â”‚    â”‚    â””â”€ If fails: 500 "Server error"
    â”‚    â””â”€ Return success response
    â”‚
    â”œâ”€ Frontend Response Handler
    â”‚    â”œâ”€ If success: Show toast, update UI
    â”‚    â”œâ”€ If error: Show error message
    â”‚    â””â”€ Always: Stop loading spinner
    â”‚
    â””â”€ User sees result
```

---

## Performance Considerations

```
Frontend Optimizations:
âœ… Component cleanup with takeUntil
âœ… OnDestroy lifecycle hook
âœ… Minimal DOM manipulation
âœ… CSS animations (not JavaScript)
âœ… Lazy loading (future)
âœ… Virtual scrolling for large lists (future)

Backend Optimizations:
âœ… Database indexes on user_id, status
âœ… Populate references efficiently
âœ… No N+1 queries
âœ… Atomic operations (no transactions needed)
âœ… Connection pooling
âœ… Caching headers

Data Optimizations:
âœ… Only fetch user's own orders
âœ… Pagination (future)
âœ… Date formatting on client
âœ… Status calculations efficient
```

---

**Architecture Version**: 1.0
**Last Updated**: January 2024
**Status**: âœ… Complete and Production Ready
