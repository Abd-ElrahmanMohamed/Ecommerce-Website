<app-header></app-header>

<!-- Hero Section -->
<section class="hero">
  <img
    src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=1200&h=400&fit=crop"
    alt="Account Hero"
    class="hero-bg"
  />
  <div class="hero-overlay"></div>
  <div class="hero-content">
    <h1>My Account</h1>
    <p>Manage your profile and orders</p>
  </div>
</section>

<!-- Messages -->
<div class="container">
  <div *ngIf="successMessage" class="alert alert-success">
    <i class="fas fa-check-circle"></i> {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-danger">
    <i class="fas fa-exclamation-circle"></i> {{ errorMessage }}
  </div>
</div>

<div *ngIf="isLoading" class="loading"><i class="fas fa-spinner fa-spin"></i> Loading...</div>

<div *ngIf="!isLoading && user" class="account-container">
  <div class="container">
    <div class="account-layout">
      <!-- Sidebar Navigation -->
      <aside class="account-sidebar">
        <div class="user-profile">
          <div class="avatar">{{ (user.name || 'U').charAt(0).toUpperCase() }}</div>
          <h3>{{ user.name || 'User' }}</h3>
          <p>{{ user.email }}</p>
          <p class="phone-number">{{ user.mobile || user.phone || 'N/A' }}</p>
        </div>

        <nav class="account-nav">
          <button
            class="nav-link"
            [class.active]="activeTab === 'overview'"
            (click)="activeTab = 'overview'"
          >
            <i class="fas fa-user-circle"></i>
            My Account
          </button>
          <button
            class="nav-link"
            [class.active]="activeTab === 'orders'"
            (click)="activeTab = 'orders'"
          >
            <i class="fas fa-box"></i>
            My Orders
          </button>
          <button
            class="nav-link"
            [class.active]="activeTab === 'addresses'"
            (click)="activeTab = 'addresses'"
          >
            <i class="fas fa-map-marker-alt"></i>
            Addresses
          </button>
          <button
            class="nav-link"
            [class.active]="activeTab === 'returns'"
            (click)="activeTab = 'returns'"
          >
            <i class="fas fa-undo"></i>
            Returns
          </button>
          <button
            class="nav-link"
            [class.active]="activeTab === 'reviews'"
            (click)="activeTab = 'reviews'"
          >
            <i class="fas fa-star"></i>
            Reviews
          </button>
          <button
            class="nav-link"
            [class.active]="activeTab === 'settings'"
            (click)="activeTab = 'settings'"
          >
            <i class="fas fa-cog"></i>
            Settings
          </button>
          <button class="nav-link logout-btn" (click)="logout()">
            <i class="fas fa-sign-out-alt"></i>
            Logout
          </button>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="account-main">
        <!-- Overview Tab -->
        <div class="tab-content" *ngIf="activeTab === 'overview'">
          <h2><i class="fas fa-user-circle"></i> My Account Overview</h2>

          <!-- Stats Cards -->
          <div class="stats-grid">
            <div class="stat-card" *ngFor="let stat of userStats">
              <div class="stat-icon">
                <i [class]="stat.icon"></i>
              </div>
              <div class="stat-content">
                <p class="stat-label">{{ stat.label }}</p>
                <p class="stat-value">{{ stat.value }}</p>
              </div>
            </div>
          </div>

          <!-- Personal Information Card -->
          <div class="info-card">
            <div class="card-header">
              <h3><i class="fas fa-id-card"></i> Personal Information</h3>
              <button class="btn-edit"><i class="fas fa-edit"></i> Edit</button>
            </div>
            <div class="info-grid">
              <div class="info-item">
                <label><i class="fas fa-user"></i> First Name</label>
                <p>{{ user.firstName }}</p>
              </div>
              <div class="info-item">
                <label><i class="fas fa-user"></i> Last Name</label>
                <p>{{ user.lastName }}</p>
              </div>
              <div class="info-item">
                <label><i class="fas fa-envelope"></i> Email</label>
                <p>{{ user.email }}</p>
              </div>
              <div class="info-item">
                <label><i class="fas fa-phone"></i> Phone</label>
                <p>{{ user.phone }}</p>
              </div>
              <div class="info-item">
                <label><i class="fas fa-calendar"></i> Joined</label>
                <p>{{ user.createdAt | date: 'MMM d, yyyy' }}</p>
              </div>
              <div class="info-item">
                <label><i class="fas fa-crown"></i> Member Status</label>
                <p>
                  <span class="badge badge-gold">{{
                    user.role === 'admin' ? 'Admin' : 'Gold Member'
                  }}</span>
                </p>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="quick-actions">
            <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
            <div class="actions-grid">
              <button class="action-btn" (click)="activeTab = 'orders'">
                <i class="fas fa-box"></i>
                <span>View Orders</span>
              </button>
              <button class="action-btn" (click)="activeTab = 'addresses'">
                <i class="fas fa-map-marker-alt"></i>
                <span>Manage Addresses</span>
              </button>
              <button class="action-btn" (click)="activeTab = 'settings'">
                <i class="fas fa-lock"></i>
                <span>Change Password</span>
              </button>
              <button class="action-btn" (click)="activeTab = 'settings'">
                <i class="fas fa-cog"></i>
                <span>Preferences</span>
              </button>
            </div>
          </div>

          <!-- Account Activity -->
          <div class="activity-card" *ngIf="orders.length > 0">
            <h3><i class="fas fa-history"></i> Recent Orders</h3>
            <ul class="activity-list">
              <li *ngFor="let order of orders | slice: 0 : 4">
                <span class="activity-icon"
                  ><i class="fas fa-shopping-bag" style="color: #27ae60"></i
                ></span>
                <span class="activity-text">Order #{{ order.id }} - {{ order.items }} item(s)</span>
                <span class="activity-time">{{ order.date | date: 'short' }}</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- Orders Tab -->
        <div class="tab-content" *ngIf="activeTab === 'orders'">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
            "
          >
            <h2>My Orders</h2>
            <button
              style="
                background: #007bff;
                color: white;
                padding: 8px 16px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
              "
              (click)="debugOrders()"
            >
              <i class="fas fa-bug"></i> Debug
            </button>
          </div>

          <div class="orders-list" *ngIf="orders.length > 0">
            <div class="order-item" *ngFor="let order of orders">
              <div class="order-header">
                <div>
                  <h4>Order #{{ order.id }}</h4>
                  <p class="order-date">{{ order.date | date: 'short' }}</p>
                </div>
                <div class="order-status">
                  <span [class]="'status ' + getStatusClass(order.status)">{{ order.status }}</span>
                </div>
              </div>
              <div class="order-details">
                <p>
                  <strong>{{ order.itemsCount }}</strong> item(s)
                </p>
                <p class="order-total">EGP {{ order.total | number: '1.2-2' }}</p>
              </div>
              <button class="btn-view" (click)="viewOrder(order.id)">View Order</button>
            </div>
          </div>
          <div *ngIf="orders.length === 0" class="empty-state">
            <i class="fas fa-box"></i>
            <p>No orders yet</p>
            <a href="/products" class="btn-primary">Start Shopping</a>
          </div>
        </div>

        <!-- Addresses Tab -->
        <div class="tab-content" *ngIf="activeTab === 'addresses'">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
            "
          >
            <h2>My Addresses</h2>
            <button
              style="
                background: #007bff;
                color: white;
                padding: 8px 16px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
              "
              (click)="debugAddresses()"
            >
              <i class="fas fa-bug"></i> Debug
            </button>
          </div>

          <!-- Loading State -->
          <div *ngIf="isLoading" class="loading-state">
            <p>Loading addresses...</p>
          </div>

          <!-- Addresses List -->
          <div class="addresses-list" *ngIf="!isLoading && addresses.length > 0">
            <div class="address-item" *ngFor="let addr of addresses">
              <div class="address-header">
                <h4>
                  <i class="fas" [ngClass]="getAddressIcon(addr.type)"></i>
                  {{ addr.type | titlecase }}
                </h4>
                <span class="default-badge" *ngIf="addr.isDefault">
                  <i class="fas fa-star"></i> Default
                </span>
              </div>
              <div class="address-details">
                <p class="address-text">
                  <strong>{{ addr.street }}</strong
                  ><br />
                  {{ addr.city }}, {{ addr.state }} {{ addr.zipCode }}
                </p>
              </div>
              <div class="address-actions">
                <button class="btn-small" (click)="editAddress(addr.id)" title="Edit address">
                  <i class="fas fa-edit"></i> Edit
                </button>
                <button
                  class="btn-small"
                  *ngIf="!addr.isDefault"
                  (click)="setAddressAsDefault(addr.id)"
                  title="Set as default delivery address"
                >
                  <i class="fas fa-check"></i> Set as Default
                </button>
                <button
                  class="btn-small btn-danger"
                  (click)="deleteAddress(addr.id)"
                  title="Delete this address"
                >
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            </div>
          </div>

          <!-- Empty State -->
          <div *ngIf="!isLoading && addresses.length === 0" class="empty-state">
            <i class="fas fa-map-pin"></i>
            <h3>No Addresses Yet</h3>
            <p>Add your first delivery address to get started.</p>
          </div>

          <!-- Add New Address Button -->
          <button class="btn-primary" (click)="addAddress()" *ngIf="!isLoading">
            <i class="fas fa-plus"></i> Add New Address
          </button>
        </div>

        <!-- Edit Address Modal -->
        <div class="modal" [class.show]="editingAddressId !== null">
          <div class="modal-content">
            <div class="modal-header">
              <h3>Edit Address</h3>
              <button class="modal-close" (click)="closeEditModal()">
                <i class="fas fa-times"></i>
              </button>
            </div>

            <form (ngSubmit)="submitAddressEdit()" class="address-form">
              <div class="form-row">
                <div class="form-group">
                  <label>Address Type</label>
                  <select [(ngModel)]="editingAddress.type" name="type">
                    <option value="home">Home</option>
                    <option value="office">Office</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Street Address</label>
                  <input
                    type="text"
                    [(ngModel)]="editingAddress.street"
                    name="street"
                    placeholder="Street address"
                    required
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>City</label>
                  <input
                    type="text"
                    [(ngModel)]="editingAddress.city"
                    name="city"
                    placeholder="City"
                    required
                  />
                </div>
                <div class="form-group">
                  <label>State</label>
                  <input
                    type="text"
                    [(ngModel)]="editingAddress.state"
                    name="state"
                    placeholder="State"
                    required
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Zip Code</label>
                  <input
                    type="text"
                    [(ngModel)]="editingAddress.zipCode"
                    name="zipCode"
                    placeholder="Zip code"
                    required
                  />
                </div>
              </div>

              <div class="modal-actions">
                <button type="button" class="btn-secondary" (click)="closeEditModal()">
                  Cancel
                </button>
                <button type="submit" class="btn-primary">
                  <i class="fas fa-save"></i> Save Changes
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal" [class.show]="deletingAddressId !== null">
          <div class="modal-content modal-confirm">
            <div class="modal-header">
              <h3>Delete Address</h3>
              <button class="modal-close" (click)="cancelDeleteAddress()">
                <i class="fas fa-times"></i>
              </button>
            </div>

            <div class="modal-body">
              <div class="confirm-icon">
                <i class="fas fa-exclamation-triangle"></i>
              </div>
              <h4>Are you sure?</h4>
              <p>Are you sure you want to delete this address? This action cannot be undone.</p>
            </div>

            <div class="modal-actions">
              <button type="button" class="btn-secondary" (click)="cancelDeleteAddress()">
                <i class="fas fa-times"></i> Cancel
              </button>
              <button type="button" class="btn-danger" (click)="confirmDeleteAddress()">
                <i class="fas fa-trash"></i> Delete Address
              </button>
            </div>
          </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" *ngIf="activeTab === 'settings'">
          <h2>Settings</h2>

          <div class="settings-card">
            <h3>Change Password</h3>
            <form (ngSubmit)="updatePassword()">
              <div class="form-group">
                <label>Current Password</label>
                <input
                  type="password"
                  [(ngModel)]="passwordForm.currentPassword"
                  name="currentPassword"
                  placeholder="Enter current password"
                />
              </div>
              <div class="form-group">
                <label>New Password</label>
                <input
                  type="password"
                  [(ngModel)]="passwordForm.newPassword"
                  name="newPassword"
                  placeholder="Enter new password"
                />
              </div>
              <div class="form-group">
                <label>Confirm Password</label>
                <input
                  type="password"
                  [(ngModel)]="passwordForm.confirmPassword"
                  name="confirmPassword"
                  placeholder="Confirm new password"
                />
              </div>
              <button type="submit" class="btn-primary">Update Password</button>
            </form>
          </div>

          <div class="settings-card">
            <h3>Preferences</h3>
            <div class="preference-item">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  [(ngModel)]="settings.emailNotifications"
                  name="emailNotifications"
                />
                <span>Subscribe to promotional emails</span>
              </label>
            </div>
            <div class="preference-item">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  [(ngModel)]="settings.smsNotifications"
                  name="smsNotifications"
                />
                <span>SMS notifications</span>
              </label>
            </div>
            <div class="preference-item">
              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="settings.newsletter" name="newsletter" />
                <span>Subscribe to newsletter</span>
              </label>
            </div>
            <button class="btn-primary" (click)="updateSettings()">Save Preferences</button>
          </div>
        </div>

        <!-- Returns Tab -->
        <div class="tab-content" *ngIf="activeTab === 'returns'">
          <h2><i class="fas fa-undo"></i> Returns Management</h2>

          <!-- Debug Section -->
          <div
            style="
              background: #f0f0f0;
              padding: 12px;
              border-radius: 6px;
              margin-bottom: 20px;
              font-size: 12px;
            "
          >
            <button
              (click)="debugReturns()"
              style="
                background: #007bff;
                color: white;
                padding: 6px 12px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                margin-right: 10px;
              "
            >
              <i class="fas fa-bug"></i> Debug Returns
            </button>
            <span
              >Total Orders: {{ orders.length }} | Eligible for Return:
              {{ eligibleOrdersForReturn.length }}</span
            >
          </div>

          <!-- Request Return Section -->
          <div class="returns-card">
            <h3>Request a Return</h3>
            <p class="helper-text">
              Select an order to initiate a return (within 14 days of delivery)
            </p>

            <div *ngIf="eligibleOrdersForReturn.length > 0" class="returns-form">
              <div class="form-group">
                <label>Select Order</label>
                <select [(ngModel)]="selectedOrderForReturn" name="returnOrder">
                  <option [ngValue]="null">-- Choose an order --</option>
                  <option *ngFor="let order of eligibleOrdersForReturn" [ngValue]="order">
                    Order #{{ order.id }} - {{ order.date | date: 'short' }}
                  </option>
                </select>
              </div>

              <div *ngIf="selectedOrderForReturn" class="form-group">
                <label>Return Reason</label>
                <select [(ngModel)]="returnReason" name="reason">
                  <option value="">-- Select reason --</option>
                  <option value="defective">Product Defective</option>
                  <option value="not_as_described">Not as Described</option>
                  <option value="wrong_item">Wrong Item Received</option>
                  <option value="changed_mind">Changed Mind</option>
                  <option value="damaged">Damaged in Shipping</option>
                  <option value="other">Other</option>
                </select>
              </div>

              <div *ngIf="selectedOrderForReturn && returnReason" class="form-group">
                <label>Additional Comments</label>
                <textarea
                  [(ngModel)]="returnComment"
                  name="comment"
                  placeholder="Please provide any additional details..."
                  rows="4"
                ></textarea>
              </div>

              <div *ngIf="selectedOrderForReturn && returnReason" class="form-actions">
                <button type="button" class="btn-secondary" (click)="cancelReturnRequest()">
                  Cancel
                </button>
                <button
                  type="button"
                  class="btn-primary"
                  (click)="submitReturnRequest()"
                  [disabled]="returnSubmitting"
                >
                  <i class="fas fa-paper-plane"></i> Submit Return Request
                </button>
              </div>
            </div>

            <div *ngIf="eligibleOrdersForReturn.length === 0" class="empty-state">
              <i class="fas fa-info-circle"></i>
              <p>No orders eligible for return</p>
              <p class="helper-text">Returns are available for orders within 14 days of delivery</p>
            </div>
          </div>

          <!-- Returns History Section -->
          <div class="returns-card" *ngIf="userReturns.length > 0">
            <h3><i class="fas fa-history"></i> Your Returns History</h3>
            <div class="returns-list">
              <div class="return-item" *ngFor="let ret of userReturns">
                <div class="return-header">
                  <div>
                    <h4>Order #{{ ret.orderId }}</h4>
                    <p class="return-date">{{ ret.createdAt | date: 'short' }}</p>
                  </div>
                  <div class="return-status">
                    <span [class]="'status ' + getReturnStatusClass(ret.status)">
                      {{ ret.status }}
                    </span>
                  </div>
                </div>
                <div class="return-details">
                  <p><strong>Reason:</strong> {{ ret.reason | titlecase }}</p>
                  <p *ngIf="ret.comment"><strong>Comment:</strong> {{ ret.comment }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Reviews Tab -->
        <div class="tab-content" *ngIf="activeTab === 'reviews'">
          <h2><i class="fas fa-star"></i> Reviews Management</h2>

          <!-- Submit Review Section -->
          <div class="reviews-card">
            <h3>Write a Review</h3>
            <p class="helper-text">Share your experience with products you've received</p>

            <div *ngIf="reviewableOrders.length > 0" class="review-form">
              <div class="form-group">
                <label>Select Order</label>
                <select [(ngModel)]="selectedOrderForReview" name="reviewOrder">
                  <option [ngValue]="null">-- Choose an order --</option>
                  <option *ngFor="let order of reviewableOrders" [ngValue]="order">
                    Order #{{ order.id }} - {{ order.date | date: 'short' }}
                  </option>
                </select>
              </div>

              <div *ngIf="selectedOrderForReview" class="form-group">
                <label>Rating</label>
                <div class="star-rating">
                  <div class="stars">
                    <button
                      type="button"
                      *ngFor="let star of [1, 2, 3, 4, 5]"
                      class="star"
                      [class.active]="reviewRating >= star"
                      (click)="reviewRating = star"
                    >
                      <i class="fas fa-star"></i>
                    </button>
                  </div>
                  <span class="rating-value">{{ reviewRating }} / 5</span>
                </div>
              </div>

              <div *ngIf="selectedOrderForReview" class="form-group">
                <label>Your Review</label>
                <textarea
                  [(ngModel)]="reviewComment"
                  name="comment"
                  placeholder="Share your experience with this product..."
                  rows="5"
                  maxlength="500"
                ></textarea>
                <p class="char-count">{{ reviewComment.length }} / 500 characters</p>
              </div>

              <div *ngIf="selectedOrderForReview" class="form-actions">
                <button type="button" class="btn-secondary" (click)="cancelReviewRequest()">
                  Cancel
                </button>
                <button
                  type="button"
                  class="btn-primary"
                  (click)="submitReview()"
                  [disabled]="reviewSubmitting || reviewComment.length === 0"
                >
                  <i class="fas fa-check"></i> Submit Review
                </button>
              </div>
            </div>

            <div *ngIf="reviewableOrders.length === 0" class="empty-state">
              <i class="fas fa-info-circle"></i>
              <p>No orders available for review</p>
              <p class="helper-text">Complete an order to write a review</p>
            </div>
          </div>

          <!-- Reviews History Section -->
          <div class="reviews-card" *ngIf="userReviews.length > 0">
            <h3><i class="fas fa-history"></i> Your Reviews</h3>
            <div class="reviews-list">
              <div class="review-item" *ngFor="let review of userReviews">
                <div class="review-header">
                  <div>
                    <h4>Order #{{ review.orderId }}</h4>
                    <p class="review-date">{{ review.createdAt | date: 'short' }}</p>
                  </div>
                  <div class="review-rating">
                    <span class="stars-display">
                      <i
                        *ngFor="let star of [1, 2, 3, 4, 5]"
                        class="fas fa-star"
                        [class.empty]="star > review.rating"
                      ></i>
                    </span>
                    <span class="rating-number">{{ review.rating }} / 5</span>
                  </div>
                </div>
                <div class="review-body">
                  <p>{{ review.comment }}</p>
                </div>
                <div class="review-status" *ngIf="review.approved !== undefined">
                  <span [class]="'status ' + (review.approved ? 'approved' : 'pending')">
                    {{ review.approved ? 'Approved' : 'Pending Approval' }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
</div>

<!-- Order Details Modal -->
<div class="modal" [class.show]="viewingOrderId !== null">
  <div class="modal-content modal-lg">
    <div class="modal-header">
      <h3>Order Details</h3>
      <button class="modal-close" (click)="closeOrderModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body" *ngIf="viewingOrderDetails">
      <!-- Order Header -->
      <div class="order-modal-section">
        <div class="section-row">
          <div class="section-col">
            <h4>Order Number</h4>
            <p class="section-value">
              #{{ viewingOrderDetails.orderNumber || viewingOrderDetails.id }}
            </p>
          </div>
          <div class="section-col">
            <h4>Order Date</h4>
            <p class="section-value">{{ viewingOrderDetails.date | date: 'medium' }}</p>
          </div>
          <div class="section-col">
            <h4>Order Status</h4>
            <p class="section-value">
              <span [class]="'badge ' + getStatusClass(viewingOrderDetails.status)">
                {{ viewingOrderDetails.status }}
              </span>
            </p>
          </div>
        </div>
      </div>

      <!-- Order Items -->
      <div class="order-modal-section">
        <h4>Items Ordered</h4>
        <div class="order-items">
          <div class="order-item-detail" *ngFor="let item of viewingOrderDetails.items">
            <div class="item-info">
              <p class="item-name">{{ item.name || item.productName }}</p>
              <p class="item-sku">SKU: {{ item.sku || 'N/A' }}</p>
            </div>
            <div class="item-qty">
              <p>
                Qty: <strong>{{ item.quantity || 1 }}</strong>
              </p>
            </div>
            <div class="item-price">
              <p>EGP {{ item.price || item.total | number: '1.2-2' }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Shipping Address -->
      <div class="order-modal-section">
        <h4><i class="fas fa-map-marker-alt"></i> Shipping Address</h4>
        <div class="address-box">
          <p *ngIf="viewingOrderDetails.shippingAddress?.street">
            <strong>{{ viewingOrderDetails.shippingAddress.street }}</strong>
          </p>
          <p
            *ngIf="
              viewingOrderDetails.shippingAddress?.city ||
              viewingOrderDetails.shippingAddress?.state
            "
          >
            {{ viewingOrderDetails.shippingAddress?.city }}
            <span *ngIf="viewingOrderDetails.shippingAddress?.state">
              , {{ viewingOrderDetails.shippingAddress.state }}
            </span>
          </p>
          <p *ngIf="viewingOrderDetails.shippingAddress?.zipCode">
            {{ viewingOrderDetails.shippingAddress.zipCode }}
          </p>
          <p
            *ngIf="
              !viewingOrderDetails.shippingAddress?.street &&
              !viewingOrderDetails.shippingAddress?.city
            "
            class="no-address"
          >
            <i class="fas fa-exclamation-circle"></i> Address not provided
          </p>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="order-modal-section">
        <h4>Order Summary</h4>
        <div class="order-summary">
          <div class="summary-row">
            <span>Subtotal:</span>
            <span>EGP {{ viewingOrderDetails.total * 0.9 | number: '1.2-2' }}</span>
          </div>
          <div class="summary-row">
            <span>Shipping:</span>
            <span>EGP 25.00</span>
          </div>
          <div class="summary-row">
            <span>Tax:</span>
            <span>EGP {{ viewingOrderDetails.total * 0.1 | number: '1.2-2' }}</span>
          </div>
          <div class="summary-row total">
            <span>Total:</span>
            <span>EGP {{ viewingOrderDetails.total | number: '1.2-2' }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-actions">
      <button type="button" class="btn-secondary" (click)="closeOrderModal()">Close</button>
      <button type="button" class="btn-primary" (click)="printInvoice()">
        <i class="fas fa-print"></i> Print Invoice
      </button>
      <!-- Mark as Delivered (for demo/testing) -->
      <button
        *ngIf="
          !(
            viewingOrderDetails?.status &&
            (viewingOrderDetails.status.toLowerCase() === 'delivered' ||
              viewingOrderDetails.status.toLowerCase() === 'received')
          )
        "
        type="button"
        class="btn btn-success"
        (click)="markOrderAsDelivered(viewingOrderDetails.id)"
        style="margin-left: 8px"
        title="Mark this order as Delivered (makes it eligible for return)"
      >
        <i class="fas fa-check-circle"></i> Mark as Delivered
      </button>
    </div>
  </div>
</div>

<app-footer></app-footer>
